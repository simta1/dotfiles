### Basics
set $mod Mod4
set $term wezterm
set $border_width 3

# cursor
seat seat0 hide_cursor 0
# seat seat0 xcursor_theme breeze_cursors 36
seat seat0 xcursor_theme Bibata-Modern-Ice 36
exec_always {
    export XCURSOR_THEME=Bibata-Modern-Ice
    export XCURSOR_SIZE=36
}
exec_always xrdb -merge ~/.Xresources

# bongocat
exec ~/.config/bongocat/bongocat-follow-focus.sh

# wallpaper
output * bg ~/Pictures/wallpapers/bg_cat.jpg fill

# touchpad
input type:touchpad {
    natural_scroll enabled
    tap enabled
    tap_button_map lrm
    pointer_accel 0.5

	drag enabled
	drag_lock disabled
}

bindsym Ctrl+F9 exec "swaymsg input type:touchpad events disabled && notify-send 'Touchpad' 'Touchpad disabled'"
bindsym Ctrl+F10 exec "swaymsg input type:touchpad events enabled && notify-send 'Touchpad' 'Touchpad enabled'"

# border, gap
default_border pixel $border_width
default_floating_border pixel $border_width
gaps inner 10
gaps outer 10
smart_gaps off
hide_edge_borders none

# environment
exec_always systemctl --user import-environment DISPLAY WAYLAND_DISPLAY SWAYSOCK XDG_CURRENT_DESKTOP
exec_always dbus-update-activation-environment --systemd DISPLAY WAYLAND_DISPLAY SWAYSOCK XDG_CURRENT_DESKTOP
exec_always systemctl --user start sway-session.target

# IME, 바/알림, 트레이 앱들(i3 exec 옮김)
exec nm-applet --indicator
exec blueman-applet
exec mpd
# exec swaync
exec mako

# fcitx
exec fcitx5
input * {
    xkb_layout "us,kr"
    xkb_options "korean:ralt_hangul,korean:rctrl_hanja,caps:escape"
}

# swaylock
bindsym $mod+Shift+x exec swaylock \
  --clock --indicator \
  --hide-keyboard-layout \
  --indicator-radius 90 \
  --indicator-thickness 8 \
  --font-size 36 \
  --indicator-x-position 140 \
  --indicator-y-position 1060 \
  --image eDP-1:~/Pictures/wallpapers/bg_lock.jpg \
  --image HDMI-A-1:~/Pictures/wallpapers/bg_lock.jpg

# Shortcuts
floating_modifier $mod
bindsym $mod+Return exec $term
bindsym $mod+shift+f exec /usr/bin/firefox --new-window
bindsym $mod+Shift+z exec MOZ_ENABLE_WAYLAND=1 zen-browser
bindsym $mod+g exec ghostty
bindsym $mod+Shift+q kill

# waybar
bindsym $mod+b exec pkill -x waybar || waybar

# change focus
bindsym $mod+h      focus left
bindsym $mod+j      focus down
bindsym $mod+k      focus up
bindsym $mod+l      focus right
bindsym $mod+Left   focus left
bindsym $mod+Down   focus down
bindsym $mod+Up     focus up
bindsym $mod+Right  focus right

# move focused window
bindsym $mod+Shift+h        move left   50 px
bindsym $mod+Shift+j        move down   50 px
bindsym $mod+Shift+k        move up     50 px
bindsym $mod+Shift+l        move right  50 px
bindsym $mod+Shift+Left     move left   50 px
bindsym $mod+Shift+Down     move down   50 px
bindsym $mod+Shift+Up       move up     50 px
bindsym $mod+Shift+Right    move right  50 px
bindsym $mod+Shift+c        move position center

# split
bindsym $mod+Shift+b splith
bindsym $mod+Shift+v splitv

# fullscreen/layout
bindsym $mod+f fullscreen toggle
bindsym $mod+q layout stacking
bindsym $mod+w layout tabbed
bindsym $mod+e layout toggle split

# tiling/floating
bindsym $mod+Shift+space floating toggle
bindsym $mod+space focus mode_toggle

# scratchpad
bindsym $mod+minus move scratchpad
bindsym $mod+Shift+minus scratchpad show

# workspaces
set $ws1 1
set $ws2 2
set $ws3 3
set $ws4 4
set $ws5 5
set $ws6 6
set $ws7 7
set $ws8 8
set $ws9 9
set $ws10 10

bindsym $mod+1 workspace number $ws1
bindsym $mod+2 workspace number $ws2
bindsym $mod+3 workspace number $ws3
bindsym $mod+4 workspace number $ws4
bindsym $mod+5 workspace number $ws5
bindsym $mod+6 workspace number $ws6
bindsym $mod+7 workspace number $ws7
bindsym $mod+8 workspace number $ws8
bindsym $mod+9 workspace number $ws9
bindsym $mod+0 workspace number $ws10

bindsym $mod+Shift+1 move container to workspace number $ws1
bindsym $mod+Shift+2 move container to workspace number $ws2
bindsym $mod+Shift+3 move container to workspace number $ws3
bindsym $mod+Shift+4 move container to workspace number $ws4
bindsym $mod+Shift+5 move container to workspace number $ws5
bindsym $mod+Shift+6 move container to workspace number $ws6
bindsym $mod+Shift+7 move container to workspace number $ws7
bindsym $mod+Shift+8 move container to workspace number $ws8
bindsym $mod+Shift+9 move container to workspace number $ws9
bindsym $mod+Shift+0 move container to workspace number $ws10

# reload/restart
bindsym $mod+Shift+r reload

# rofi
bindsym $mod+d exec rofi -show drun -no-default-config -config ~/.config/rofi/config.rasi

# 음량/음소거
bindsym --locked XF86AudioRaiseVolume exec pactl set-sink-volume @DEFAULT_SINK@ +5% && pactl set-sink-mute @DEFAULT_SINK@ 0
bindsym --locked XF86AudioLowerVolume exec pactl set-sink-volume @DEFAULT_SINK@ -5% && pactl set-sink-mute @DEFAULT_SINK@ 0
bindsym --locked Shift+XF86AudioRaiseVolume exec pactl set-sink-volume @DEFAULT_SINK@ +1% && pactl set-sink-mute @DEFAULT_SINK@ 0
bindsym --locked Shift+XF86AudioLowerVolume exec pactl set-sink-volume @DEFAULT_SINK@ -1% && pactl set-sink-mute @DEFAULT_SINK@ 0
bindsym --locked XF86AudioMute exec pactl set-sink-mute @DEFAULT_SINK@ toggle
bindsym --locked XF86AudioMicMute exec pactl set-source-mute @DEFAULT_SOURCE@ toggle

# brightness
bindsym --locked XF86MonBrightnessUp exec brightnessctl set +5%
bindsym --locked XF86MonBrightnessDown exec brightnessctl set 5%-
bindsym --locked Shift+XF86MonBrightnessUp exec brightnessctl set +1%
bindsym --locked Shift+XF86MonBrightnessDown exec brightnessctl set 1%-

# screenshot
# bindsym Print        exec grim -g "$(slurp)" - | swappy -f -
bindsym $mod+Shift+s exec sh -c '\
    dir="$HOME/Pictures/Screenshots"; \
    mkdir -p "$dir"; \
    base="$dir/Screenshot_$(date +%Y%m%d_%H%M%S)"; \
    file="${base}.png"; \
    count=1; \
    while [ -e "$file" ]; do \
        file="${base}_$count.png"; \
        count=$((count+1)); \
    done; \
    freeze=$(mktemp --suffix=.png); \
    grim "$freeze"; \
    imv -f "$freeze" & pid=$!; \
    grim -g "$(slurp)" "$file" && wl-copy < "$file" && \
        notify-send "스크린샷" "저장: $file" -i "$file"; \
    kill $pid; rm "$freeze" \
'

# screenshot 이후 imv가 종료되지 않을 경우
bindsym $mod+Shift+Escape exec 'pkill -TERM -x imv || true'

# turn off screen
# bindsym XF86ScreenSaver exec --no-startup-id xset dpms force off
bindsym XF86ScreenSaver exec swaymsg "output * dpms off"

# resize mode
mode "resize" {
    bindsym h       resize shrink width 10px
    bindsym j       resize grow height 10px
    bindsym k       resize shrink height 10px
    bindsym l       resize grow width 10px
    bindsym Left    resize shrink width 10px
    bindsym Down    resize grow height 10px
    bindsym Up      resize shrink height 10px
    bindsym Right   resize grow width 10px
    bindsym Return  mode "default"
    bindsym Escape  mode "default"
    bindsym $mod+r  mode "default"
}
bindsym $mod+r mode "resize"

# 없는 속성은 -로 출력
# bindsym $mod+Shift+i exec sh -c 'body=$(swaymsg -t get_tree | jq -r '"'"'.. | objects | select(.focused? == true) | "app_id=\(.app_id // "-")\nclass=\(.window_properties.class // "-")\ninstance=\(.window_properties.instance // "-")\nrole=\(.window_properties.window_role // "-")\ntype=\(.window_type // "-")\nshell=\(.shell // "-")\ntitle=\(.name // "-")"'"'"'); notify-send "Focused window" "$body"'

# 없는 속성은 출력 안함
bindsym $mod+Shift+i exec sh -c 'body=$(swaymsg -t get_tree | jq -r '"'"'.. | objects | select(.focused? == true) | {app_id:.app_id, class:.window_properties.class, instance:.window_properties.instance, role:.window_properties.window_role, type:.window_type, shell:.shell, title:.name} | to_entries | map(select(.value != null and .value != "")) | map("\(.key)=\(.value)") | join("\n")'"'"'); notify-send "Focused window" "$body"'

# floating
# for_window [class="(?i)tk"] floating enable
for_window [app_id="bottles"] floating enable, border pixel $border_width
for_window [class="(?i)kakaotalk.exe"] floating enable, move position center, border pixel $border_width
for_window [app_id="spectacle"] floating enable
for_window [app_id="firefox"] border pixel $border_width
for_window [class="Firefox"] border pixel $border_width

# monitor settings
# bindsym $mod+n exec --no-startup-id xrandr --auto --output eDP-1 --mode 1920x1080 --right-of HDMI-1 && i3-msg restart &
# bindsym $mod+m exec --no-startup-id xrandr --auto --output HDMI-1 --off && i3-msg restart &

# TODO

# swaymsg -t get_outputs
# 내장 FHD만
bindsym $mod+m exec swaymsg 'output HDMI-A-1 disable; output eDP-1 mode 1920x1080 position 0,0'

# 듀얼: eDP-1을 왼쪽, HDMI를 오른쪽
bindsym $mod+n exec swaymsg 'output eDP-1 enable mode 1920x1080 position 0,0; output HDMI-A-1 enable position 1920,0'

# 
focus_on_window_activation focus

# exit i3 (logs you out of your X session)
# bindsym $mod+Shift+e exec "i3-nagbar -t warning -m 'You pressed the exit shortcut. Do you really want to exit i3? This will end your X session.' -B 'Yes, exit i3' 'i3-msg exit'"
bindsym $mod+Shift+e exec 'swaynag -t warning -m "Exit sway?" -B "Yes" "swaymsg exit"'

# border colors
client.focused          #D966FF #282A36 #F8F8F2 #50FA7B #D966FF
client.focused_inactive #5A6773 #282A36 #F8F8F2 #7082C9 #5A6773
client.unfocused        #5A6773 #282A36 #F8F8F2 #7082C9 #5A6773
client.urgent           #FF5555 #282A36 #F8F8F2 #FF5555 #FF5555

# 메모장 대용
# bindsym $mod+Shift+n exec wezterm start -- nvim +startinsert
bindsym $mod+Shift+n exec neovide -- -c "startinsert"

# ps폴더 기준으로 엶 + ps할 때 스택 터지는 거 방지
bindsym $mod+Shift+p exec sh -c 'ulimit -s unlimited && cd "$HOME/vsc/ps" && exec neovide --grid 120x40'

bar {
    swaybar_command waybar
}

# ------------------------------------------------
# ------------------------------------------------
# ------------------------------------------------

# # save and restore layout with i3-resurrect
# bindsym $mod+t  exec --no-startup-id i3-resurrect restore
# bindsym $mod+y  exec --no-startup-id i3-resurrect save
